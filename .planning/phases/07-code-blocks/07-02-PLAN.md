---
phase: 07-code-blocks
plan: 02
type: execute
wave: 1
depends_on: []
files_modified:
    - src/lib/components/molecules/CodeBlock.svelte
autonomous: true

must_haves:
    truths:
        - 'Filename header displays with solid dark background (no diagonal stripe pattern)'
        - 'Language label is visible in the header (right side)'
        - 'Copy button appears in bottom-right corner of code block'
        - 'Copy button is visible at 50% opacity, 100% on hover'
        - 'On mobile, copy button is always visible at full opacity (no hover)'
    artifacts:
        - path: 'src/lib/components/molecules/CodeBlock.svelte'
          provides: 'Simplified header, visible language label, repositioned copy button'
          min_lines: 150
    key_links:
        - from: 'figcaption.filename-container'
          to: '.lang'
          via: 'CSS display property'
          pattern: '\\.lang.*display'
        - from: '.copy-button'
          to: 'figure'
          via: 'absolute positioning bottom-right'
          pattern: 'bottom.*right|position.*absolute'
---

<objective>
Modernize code block header and copy button: remove decorative diagonal strip, show language label, reposition copy button to bottom-right with improved visibility behavior.

Purpose: Create a cleaner, more functional header that shows relevant information (filename +
language) and provides reliable access to the copy feature on all devices. Output: Simplified header
design with visible language label and bottom-right copy button with proper opacity behavior.
</objective>

<execution_context> @./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md </execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/07-code-blocks/07-CONTEXT.md
@.planning/phases/07-code-blocks/07-RESEARCH.md
@src/lib/components/molecules/CodeBlock.svelte
</context>

<tasks>

<task type="auto">
  <name>Task 1: Remove DiagonalStrip and simplify header</name>
  <files>src/lib/components/molecules/CodeBlock.svelte</files>
  <action>
Remove the DiagonalStrip component and simplify the header background:

1. Remove the DiagonalStrip import:
    - Delete: `import DiagonalStrip from '$components/atoms/DiagonalStrip.svelte';`

2. Remove the DiagonalStrip usage in the template:
    - Delete the entire `<div class="caption-background">` block containing DiagonalStrip

3. Update the figcaption.filename-container styles:
    - Change `background: var(--color--secondary-tint);` to a darker solid color:
      `background-color: #141414;`
    - Remove or simplify the border styling to: `border: none;` (cleaner look)
    - Update the header layout to flex with space-between to position filename left, language right

4. Remove the `.caption-background` CSS rule entirely (no longer needed)

5. Update figcaption layout for filename/language:
    - Make figcaption `display: flex; justify-content: space-between; align-items: center;`
    - Keep `.filename-content` as-is (flex container for icon + filename) </action> <verify> Grep
      confirms DiagonalStrip is no longer imported or used:
      `grep -n "DiagonalStrip" src/lib/components/molecules/CodeBlock.svelte` returns nothing.
      `npm run check` passes. </verify> <done> DiagonalStrip removed. Header has solid dark
      (#141414) background with flex layout. </done> </task>

<task type="auto">
  <name>Task 2: Show language label in header</name>
  <files>src/lib/components/molecules/CodeBlock.svelte</files>
  <action>
Make the language label visible:

1. Update the `.lang` CSS rule:
    - Remove `display: none;`
    - Add styles for visibility:
        ```scss
        .lang {
            font-family: var(--font--mono), monospace;
            font-size: 12px;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            color: rgba(255, 255, 255, 0.5);
        }
        ```

2. Show language label even when filename is not present:
    - Modify the template conditional: The header should show if filename OR lang is present
    - Change `{#if filename}` to `{#if filename || lang}`
    - Adjust the template to handle cases where only language is shown (no filename)

3. When only language is present (no filename):
    - The header should still show with just the language label on the right
    - The filename-content div can be empty or hidden when no filename </action> <verify> Visual
      check: Code blocks with language specified show the language in the header. `npm run check`
      passes. </verify> <done> Language label visible in header, right-aligned. Header shows when
      either filename or language is present. </done> </task>

<task type="auto">
  <name>Task 3: Reposition copy button to bottom-right with opacity behavior</name>
  <files>src/lib/components/molecules/CodeBlock.svelte</files>
  <action>
Reposition the copy button and update its visibility behavior:

1. Update copy button positioning:
    - Change from `top: 8px; right: 8px;` to `bottom: 8px; right: 8px;`
    - Remove the rule `&:has(figcaption.filename-container) :global(.copy-button) { top: 42px; }`
      (no longer needed)

2. Update opacity behavior for desktop:
    - Default opacity: `opacity: 0.5;` (always visible at 50%)
    - On hover: `opacity: 1;` (full opacity)
    - Remove the intermediate hover states (0.4, 0.7)

3. Update opacity behavior for mobile (touch devices):
    - Add media query for touch/mobile: `@media (hover: none)` or use breakpoint
    - On mobile: `opacity: 1;` always (no hover available)

4. Simplify the CSS:

    ```scss
    :global(.copy-button) {
        position: absolute;
        bottom: 8px;
        right: 8px;
        z-index: 2;
        opacity: 0.5;
        transition: opacity 0.2s ease-in-out;
        width: 20ch;

        &:hover {
            opacity: 1;
        }

        @media (hover: none) {
            opacity: 1;
        }
    }
    ```

5. Remove the figure:hover rule for copy button opacity (no longer needed, button is always
   visible). </action> <verify> Visual check:

- Copy button appears in bottom-right of code block
- On desktop: 50% opacity, 100% on hover
- On mobile (check in dev tools with touch simulation): always 100% opacity `npm run check` passes.
  </verify> <done> Copy button repositioned to bottom-right with 0.5 default opacity, 1.0 on hover,
  always visible on mobile. </done> </task>

</tasks>

<verification>
After all tasks complete:
1. `npm run check` passes
2. `npm run build` passes
3. DiagonalStrip no longer appears in code block headers
4. Language label visible in header (right side) when language is specified
5. Copy button in bottom-right corner
6. Copy button opacity: 50% default, 100% hover (desktop) or always 100% (mobile)
</verification>

<success_criteria>

- CODE-03: Filename header has solid dark background (no diagonal stripe)
- CODE-04: Language label visible in header right side
- CODE-05: Copy button in bottom-right, 50% opacity default, 100% hover, always visible on mobile
- Build passes, no regressions </success_criteria>

<output>
After completion, create `.planning/phases/07-code-blocks/07-02-SUMMARY.md`
</output>
