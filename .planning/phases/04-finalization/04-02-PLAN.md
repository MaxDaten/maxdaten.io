---
phase: 04-finalization
plan: 02
type: execute
wave: 1
depends_on: []
files_modified:
    - src/routes/sitemap.xml/+server.ts
    - svelte.config.js
    - mdsvex.config.js
    - src/lib/components/atoms/MarkdownImage.svelte
    - src/lib/components/organisms/MdsvexWrapper.svelte
    - src/content/.DS_Store
autonomous: true

must_haves:
    truths:
        - 'Sitemap at /sitemap.xml includes all blog post URLs'
        - 'Sitemap excludes 404 page'
        - 'Sitemap does not include individual gem pages (only /gems listing)'
        - 'MDsveX configuration removed from svelte.config.js'
        - 'No .svx or .md extensions registered in SvelteKit'
    artifacts:
        - path: 'src/routes/sitemap.xml/+server.ts'
          provides: 'Sitemap with correct exclusions'
          contains: '404'
        - path: 'svelte.config.js'
          provides: 'SvelteKit config without MDsveX'
          min_lines: 15
    key_links:
        - from: 'src/routes/sitemap.xml/+server.ts'
          to: 'src/lib/sanity/queries.ts'
          via: 'allPostsQuery import'
          pattern: 'import.*allPostsQuery'
---

<objective>
Verify sitemap configuration and remove MDsveX artifacts

Purpose: Complete Phase 4 cleanup by ensuring sitemap meets CONTEXT.md requirements and removing
unused markdown processing infrastructure Output: Working sitemap with correct exclusions, clean
svelte.config.js without MDsveX </objective>

<execution_context> @./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md </execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/04-finalization/04-CONTEXT.md
@.planning/phases/04-finalization/04-RESEARCH.md
@src/routes/sitemap.xml/+server.ts
@svelte.config.js
</context>

<tasks>

<task type="auto">
  <name>Task 1: Update sitemap exclusion patterns</name>
  <files>src/routes/sitemap.xml/+server.ts</files>
  <action>
1. Add 404 page to excludeRoutePatterns per CONTEXT.md and best practice:
   ```typescript
   excludeRoutePatterns: [
     '.*\\/preview.*',
     '.*\\/og-preview.*',
     '.*\\/og\\.jpg\\/preview.*',
     '.*\\/about\\/.*',
     '.*\\/404.*',  // Add this line
   ],
   ```

2. Verify gems are NOT included in paramValues (they shouldn't be - gems have no individual pages,
   only /gems listing which is auto-discovered)

Note: The sitemap already works correctly - this is a minor enhancement for best practice </action>
<verify>

- `npm run build` succeeds
- `grep "404" src/routes/sitemap.xml/+server.ts` shows exclusion pattern
- `npm run preview` and fetch /sitemap.xml confirms:
    - All blog post URLs present (9 posts)
    - /404 NOT in sitemap
    - /gems present (listing page)
    - No individual gem URLs (they don't exist as pages) </verify> <done>Sitemap excludes 404 and
      includes all expected URLs</done> </task>

<task type="auto">
  <name>Task 2: Remove MDsveX configuration and artifacts</name>
  <files>svelte.config.js, mdsvex.config.js, src/lib/components/atoms/MarkdownImage.svelte, src/lib/components/organisms/MdsvexWrapper.svelte, src/content/.DS_Store</files>
  <action>
1. Update svelte.config.js to remove MDsveX:
   - Remove `import { mdsvex } from 'mdsvex';`
   - Remove `import mdsvexConfig from './mdsvex.config.js';`
   - Remove `mdsvex(mdsvexConfig)` from preprocess array
   - Remove `.svx` and `.md` from extensions array (keep only `.svelte`)
   - Final extensions line: `extensions: ['.svelte'],`

2. Delete files no longer needed:
    - `rm mdsvex.config.js`
    - `rm src/lib/components/atoms/MarkdownImage.svelte`
    - `rm src/lib/components/organisms/MdsvexWrapper.svelte`
    - `rm src/content/.DS_Store`
    - `rmdir src/content` (directory should be empty after .DS_Store removal)

3. Run `npm run check` to verify no TypeScript errors from removed files

Note: These files are orphaned - no .svx or .md content files exist anymore after Phase 3 migration
</action> <verify>

- `npm run check` passes (no TypeScript errors)
- `npm run build` succeeds
- `grep "mdsvex" svelte.config.js` returns no matches
- `ls mdsvex.config.js` returns "No such file"
- `ls src/lib/components/atoms/MarkdownImage.svelte` returns "No such file"
- `ls src/lib/components/organisms/MdsvexWrapper.svelte` returns "No such file"
- `ls src/content/` returns "No such file or directory" </verify> <done>MDsveX completely removed,
  SvelteKit uses only .svelte extensions</done> </task>

</tasks>

<verification>
1. Build succeeds: `npm run build`
2. Type check passes: `npm run check`
3. Sitemap correct: Fetch /sitemap.xml and verify:
   - Blog posts present with lastmod dates
   - Static pages present (/, /blog, /gems)
   - /404 excluded
4. No MDsveX traces: `grep -r "mdsvex" .` finds nothing except node_modules
</verification>

<success_criteria>

- Sitemap includes all blog posts with correct lastmod dates
- Sitemap excludes 404 page
- MDsveX completely removed from svelte.config.js
- mdsvex.config.js deleted
- MarkdownImage.svelte and MdsvexWrapper.svelte deleted
- src/content/ directory removed
- Build and type check pass </success_criteria>

<output>
After completion, create `.planning/phases/04-finalization/04-02-SUMMARY.md`
</output>
