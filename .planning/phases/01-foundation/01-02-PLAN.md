---
phase: 01-foundation
plan: 02
type: execute
wave: 2
depends_on: ['01-01']
files_modified:
    - studio/schemas/objects/codeBlock.ts
    - studio/schemas/objects/callout.ts
    - studio/schemas/objects/portableImage.ts
    - studio/schemas/objects/youtubeEmbed.ts
    - studio/schemas/objects/seo.ts
    - studio/schemas/documents/post.ts
    - studio/schemas/documents/gem.ts
    - studio/schemas/index.ts
autonomous: true

must_haves:
    truths:
        - 'Author can create a blog post with title, slug, body, excerpt, cover image, date, tags,
          keywords, hidden'
        - 'Author can add code blocks to blog post body with language, filename, line numbers'
        - 'Author can add callouts (info/warning/tip) to blog post body'
        - 'Author can add images with alt text and captions to blog post body'
        - 'Author can create a gem with title, url, description, tags, manual slug'
        - 'Blog post slug validates unique across posts AND gems'
    artifacts:
        - path: 'studio/schemas/objects/codeBlock.ts'
          provides: 'Code block object for Portable Text'
          exports: ['codeBlockType']
        - path: 'studio/schemas/objects/callout.ts'
          provides: 'Callout block object (info/warning/tip)'
          exports: ['calloutType']
        - path: 'studio/schemas/objects/portableImage.ts'
          provides: 'Image block with alt/caption for body'
          exports: ['portableImageType']
        - path: 'studio/schemas/objects/seo.ts'
          provides: 'SEO metadata object'
          exports: ['seoType']
        - path: 'studio/schemas/documents/post.ts'
          provides: 'Blog post document schema'
          exports: ['postType']
        - path: 'studio/schemas/documents/gem.ts'
          provides: 'Gem document schema'
          exports: ['gemType']
    key_links:
        - from: 'studio/schemas/documents/post.ts'
          to: 'studio/schemas/objects/codeBlock.ts'
          via: 'body array member type'
          pattern: 'type.*codeBlock'
        - from: 'studio/schemas/documents/post.ts'
          to: 'studio/schemas/documents/tag.ts'
          via: 'tags reference'
          pattern: 'reference.*to.*tag'
        - from: 'studio/schemas/documents/gem.ts'
          to: 'studio/schemas/fields/slug.ts'
          via: 'isUniqueAcrossAllDocuments'
          pattern: 'isUniqueAcrossAllDocuments'
---

<objective>
Create Portable Text object types (codeBlock, callout, image, embed) and content document schemas (blog post, gem) with full field sets.

Purpose: Defines the actual content structures authors will use - blog posts with rich bodies and
gems with links. Output: Complete schemas for blog posts and gems, ready for content authoring.
</objective>

<execution_context> @./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md </execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/REQUIREMENTS.md
@.planning/phases/01-foundation/01-CONTEXT.md
@.planning/phases/01-foundation/01-RESEARCH.md
@.planning/phases/01-foundation/01-01-SUMMARY.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create Portable Text object types</name>
  <files>
    studio/schemas/objects/codeBlock.ts
    studio/schemas/objects/callout.ts
    studio/schemas/objects/portableImage.ts
    studio/schemas/objects/youtubeEmbed.ts
  </files>
  <action>
Create the custom block types for Portable Text per RESEARCH.md Pattern 4-5 and CONTEXT.md decisions.

**Code Block (studio/schemas/objects/codeBlock.ts):** Per RESEARCH.md Pattern 4, create code block
with:

- name: 'codeBlock', title: 'Code Block', type: 'object'
- icon: CodeIcon from lucide-react
- Fields:
    - code (text, required) - the actual code content
    - language (string, options.list with all languages from current Shiki setup): bash, css,
      docker, haskell, hcl, html, http, java, js, kotlin, nginx, nix, python, scss, svelte,
      terraform, text, ts, yaml initialValue: 'text'
    - filename (string, optional) - displays above code block
    - showLineNumbers (boolean, initialValue: false)
    - highlightedLines (string, optional) - comma-separated like "1,3-5,10"
- Preview: title from filename or "${language} block", subtitle from first 50 chars of code

**Callout (studio/schemas/objects/callout.ts):** Per RESEARCH.md Pattern 5, create callout with:

- name: 'callout', title: 'Callout', type: 'object'
- icon based on type (InfoIcon default)
- Fields:
    - type (string, options.list: info/warning/tip, layout: 'radio', initialValue: 'info', required)
    - content (array of block type, required) - allows rich text inside callout
- Preview: title from type capitalized, subtitle from first block text

**Portable Image (studio/schemas/objects/portableImage.ts):**

- name: 'portableImage', title: 'Image', type: 'object'
- icon: ImageIcon from lucide-react
- Fields:
    - image (image type with hotspot: true, required)
    - alt (string, required) - accessibility
    - caption (string, optional) - displayed below image
- Preview: title from alt or 'Image', media from image

**YouTube Embed (studio/schemas/objects/youtubeEmbed.ts):**

- name: 'youtubeEmbed', title: 'YouTube Video', type: 'object'
- icon: PlayCircleIcon from lucide-react
- Fields:
    - url (url, required, validation: uri scheme https, must contain youtube.com or youtu.be)
    - title (string, optional) - accessibility title
- Preview: title from title or 'YouTube Video', subtitle from url </action> <verify> ls
  /Users/jloos/Developer/maxdaten-io/maxdaten.io/studio/schemas/objects/ Verify all four object type
  files exist. </verify> <done> codeBlock.ts, callout.ts, portableImage.ts, and youtubeEmbed.ts
  created with correct fields and previews. </done> </task>

<task type="auto">
  <name>Task 2: Create blog post and gem document schemas</name>
  <files>
    studio/schemas/objects/seo.ts
    studio/schemas/documents/post.ts
    studio/schemas/documents/gem.ts
    studio/schemas/index.ts
  </files>
  <action>
Create content document schemas per CONTEXT.md decisions and RESEARCH.md complete example.

**SEO Object (studio/schemas/objects/seo.ts):** Per RESEARCH.md SEO Object Schema:

- name: 'seo', title: 'SEO', type: 'object'
- Fields:
    - metaTitle (string, max 60, description about override)
    - metaDescription (text, rows: 3, max 155)
    - ogImage (image with hotspot, optional override)
    - noIndex (boolean, initialValue: false)

**Blog Post (studio/schemas/documents/post.ts):** Per RESEARCH.md Complete Blog Post Schema with
CONTEXT.md field decisions:

- name: 'post', title: 'Blog Post', type: 'document'
- icon: FileTextIcon from lucide-react
- Groups: content (default), meta, seo
- Fields (content group):
    - title (string, required)
    - slug (slug, source: 'title', isUniqueAcrossAllDocuments, required, description with format
      hint)
    - excerpt (text, rows: 3, required, max 300)
    - body (array of Portable Text blocks + custom types)
        - block type with styles: normal, h2, h3, h4, blockquote
        - marks: decorators (bold, italic, underline, strike, code)
        - marks: annotations (external link with href url, internal link with reference to post/gem)
        - array members: codeBlock, callout, portableImage, youtubeEmbed
- Fields (meta group):
    - coverImage (image with hotspot, alt required, caption optional)
    - date (datetime, initialValue: now, required)
    - lastModified (datetime, optional, description about significant updates)
    - author (reference to author)
    - tags (array of reference to tag)
    - series (reference to series, optional)
    - hidden (boolean, initialValue: false)
- Fields (seo group):
    - keywords (array of string, layout: tags)
    - seo (seo object type)
- Preview: title, subtitle from date, media from coverImage, [Hidden] prefix if hidden
- Orderings: date desc (default), date asc

**Gem (studio/schemas/documents/gem.ts):** Per CONTEXT.md decisions for gems:

- name: 'gem', title: 'Gem', type: 'document'
- icon: GemIcon from lucide-react
- Fields:
    - title (string, required)
    - slug (slug, isUniqueAcrossAllDocuments, required, NO source - manual entry per CONTEXT.md)
    - url (url, required, validation: uri scheme http/https)
    - description (text, rows: 4, plain text per CONTEXT.md)
    - tags (array of reference to tag)
- Preview: title, subtitle from url

**Update schema index (studio/schemas/index.ts):**

- Import all object types: codeBlockType, calloutType, portableImageType, youtubeEmbedType, seoType
- Import new document types: postType, gemType
- Export array with all types: objects first, then documents </action> <verify> cd
  /Users/jloos/Developer/maxdaten-io/maxdaten.io/studio && npx tsc --noEmit TypeScript compilation
  should pass. All schemas should be valid. </verify> <done> Post and gem schemas created with all
  fields from CONTEXT.md. SEO object created. Schema index exports all types. TypeScript compiles.
  </done> </task>

</tasks>

<verification>
1. Run `cd studio && npm run dev` - Studio should start without schema errors
2. Create a new blog post:
   - Fill title, verify slug auto-generates
   - Add body content with paragraph, heading, code block, callout, image
   - Verify code block has language dropdown with all expected languages
   - Verify callout has radio buttons for info/warning/tip
   - Upload cover image, verify hotspot/crop UI appears
   - Add tags by reference, verify tag picker appears
   - Toggle hidden, verify preview shows [Hidden] prefix
3. Create a new gem:
   - Fill title, manually enter slug (no auto-generation)
   - Enter URL, verify validation requires http/https
   - Add description (plain text, no formatting)
   - Add tags (same tag picker as posts)
4. Create duplicate slug test:
   - Create post with slug "test-slug"
   - Create gem with manual slug "test-slug"
   - Should fail validation with uniqueness error
</verification>

<success_criteria>

- Blog post creation works with all fields (title, slug, body, excerpt, cover image, date, tags,
  keywords, hidden)
- Code blocks in body have language, filename, line numbers fields
- Callouts in body have type selection (info/warning/tip) and rich text content
- Inline images have alt (required) and caption fields
- Gem creation works with manual slug entry
- Slug uniqueness validates across both posts and gems
- TypeScript compiles without errors </success_criteria>

<output>
After completion, create `.planning/phases/01-foundation/01-02-SUMMARY.md`
</output>
