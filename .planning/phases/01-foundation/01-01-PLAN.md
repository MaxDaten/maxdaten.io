---
phase: 01-foundation
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
    - studio/package.json
    - studio/sanity.config.ts
    - studio/sanity.cli.ts
    - studio/tsconfig.json
    - studio/schemas/index.ts
    - studio/schemas/fields/slug.ts
    - studio/schemas/documents/tag.ts
    - studio/schemas/documents/author.ts
    - studio/schemas/documents/series.ts
autonomous: true
user_setup:
    - service: sanity
      why: 'Sanity project creation requires account and project ID'
      env_vars:
          - name: SANITY_STUDIO_PROJECT_ID
            source: 'sanity.io/manage -> Create project -> Copy project ID'
          - name: SANITY_STUDIO_DATASET
            source: "Usually 'production' (created with project)"
      dashboard_config:
          - task: 'Create Sanity project'
            location: 'sanity.io/manage -> Create new project'

must_haves:
    truths:
        - 'Sanity Studio starts locally with `npm run dev` in studio directory'
        - 'Author can create a new tag document in Studio'
        - 'Author can create a new author document in Studio with social links'
        - 'Author can create a new series document in Studio'
        - 'Slug uniqueness validates across all document types'
    artifacts:
        - path: 'studio/package.json'
          provides: 'Sanity dependencies and scripts'
          contains: '"sanity"'
        - path: 'studio/sanity.config.ts'
          provides: 'Studio configuration with schema types'
          exports: ['default']
        - path: 'studio/schemas/fields/slug.ts'
          provides: 'Reusable slug field with global uniqueness'
          exports: ['isUniqueAcrossAllDocuments']
        - path: 'studio/schemas/documents/tag.ts'
          provides: 'Tag document schema'
          exports: ['tagType']
        - path: 'studio/schemas/documents/author.ts'
          provides: 'Author document schema with social links'
          exports: ['authorType']
        - path: 'studio/schemas/documents/series.ts'
          provides: 'Series document schema'
          exports: ['seriesType']
    key_links:
        - from: 'studio/sanity.config.ts'
          to: 'studio/schemas/index.ts'
          via: 'schema.types import'
          pattern: 'schema.*types'
        - from: 'studio/schemas/documents/*.ts'
          to: 'studio/schemas/fields/slug.ts'
          via: 'isUniqueAcrossAllDocuments import'
          pattern: 'isUniqueAcrossAllDocuments'
---

<objective>
Initialize Sanity Studio project and create foundational document schemas (tag, author, series) with global slug uniqueness.

Purpose: Establishes the Sanity project structure and taxonomy documents that blog posts and gems
will reference. Output: Working Sanity Studio with tag, author, and series management. </objective>

<execution_context> @./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md </execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/REQUIREMENTS.md
@.planning/phases/01-foundation/01-CONTEXT.md
@.planning/phases/01-foundation/01-RESEARCH.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Initialize Sanity Studio project</name>
  <files>
    studio/package.json
    studio/sanity.config.ts
    studio/sanity.cli.ts
    studio/tsconfig.json
  </files>
  <action>
Create a new Sanity Studio project in the `studio/` directory.

1. Create `studio/` directory at project root
2. Initialize with `npm init -y` in studio directory
3. Install dependencies: `npm install sanity @sanity/vision lucide-react`
4. Create `studio/sanity.config.ts`:
    - Import `defineConfig` from 'sanity'
    - Import `structureTool` from 'sanity/structure'
    - Import `visionTool` from '@sanity/vision'
    - Configure with placeholder projectId (will be replaced by env var)
    - Set dataset to 'production'
    - Add structureTool and visionTool plugins
    - Schema types will be empty array initially (added in later task)

5. Create `studio/sanity.cli.ts`:
    - Import `defineCliConfig` from 'sanity/cli'
    - Configure api.projectId from env var SANITY_STUDIO_PROJECT_ID
    - Configure api.dataset from env var SANITY_STUDIO_DATASET
    - Set studioHost to 'maxdaten' (for deployment to maxdaten.sanity.studio)

6. Create `studio/tsconfig.json`:
    - Extend from sanity default:
      `"extends": "@sanity/pkg-utils/tsconfig/tsconfig.sanity-studio.json"`
    - Include: ["**/*.ts", "**/*.tsx"]
    - CompilerOptions: strict true, module "ESNext", moduleResolution "bundler"

7. Add scripts to package.json:
    - "dev": "sanity dev"
    - "build": "sanity build"
    - "deploy": "sanity deploy"
    - "start": "sanity start"

Note: Use `process.env.SANITY_STUDIO_PROJECT_ID` with fallback to placeholder string
'your-project-id' for local dev before env is set. </action> <verify> cd
/Users/jloos/Developer/maxdaten-io/maxdaten.io/studio && npm install && ls -la Verify package.json
has sanity dependency and all config files exist. </verify> <done> Studio directory exists with
package.json containing sanity dependency, sanity.config.ts, sanity.cli.ts, and tsconfig.json.
</done> </task>

<task type="auto">
  <name>Task 2: Create reusable slug field with global uniqueness</name>
  <files>
    studio/schemas/fields/slug.ts
  </files>
  <action>
Create the global slug uniqueness validation function per RESEARCH.md Pattern 2.

1. Create `studio/schemas/fields/slug.ts`
2. Import `SlugIsUniqueValidator` type from 'sanity'
3. Implement `isUniqueAcrossAllDocuments` function:
    - Parameters: slug string, context with document and getClient
    - Get client with apiVersion '2025-01-18'
    - Query all documents (not just current type) for matching slug
    - Exclude current document's draft and published versions
    - Return boolean (true if unique)

4. Use GROQ query:

```groq
!defined(*[
  !(_id in [$draft, $published]) &&
  slug.current == $slug
][0]._id)
```

Export the function for use in all document schemas that have slugs. </action> <verify> cat
/Users/jloos/Developer/maxdaten-io/maxdaten.io/studio/schemas/fields/slug.ts Verify file exports
isUniqueAcrossAllDocuments function with correct GROQ query. </verify> <done> slug.ts exports
isUniqueAcrossAllDocuments function that validates slug uniqueness across all document types.
</done> </task>

<task type="auto">
  <name>Task 3: Create tag, author, and series document schemas</name>
  <files>
    studio/schemas/documents/tag.ts
    studio/schemas/documents/author.ts
    studio/schemas/documents/series.ts
    studio/schemas/index.ts
  </files>
  <action>
Create the foundational document schemas per CONTEXT.md decisions and RESEARCH.md patterns.

**Tag schema (studio/schemas/documents/tag.ts):**

- name: 'tag', title: 'Tag', type: 'document'
- icon: TagIcon from lucide-react
- Fields:
    - name (string, required)
    - slug (slug, source: 'name', isUnique: isUniqueAcrossAllDocuments, required)
- Preview: select title from name

**Author schema (studio/schemas/documents/author.ts):**

- name: 'author', title: 'Author', type: 'document'
- icon: UserIcon from lucide-react
- Fields:
    - name (string, required)
    - bio (text, rows: 4, plain text as per CONTEXT.md)
    - avatar (image with hotspot, alt field required)
    - socialLinks (object with fields):
        - twitter (url)
        - github (url)
        - linkedin (url)
        - website (url)
- Preview: select title from name, media from avatar

**Series schema (studio/schemas/documents/series.ts):**

- name: 'series', title: 'Series', type: 'document'
- icon: LayersIcon from lucide-react
- Fields:
    - title (string, required)
    - slug (slug, source: 'title', isUnique: isUniqueAcrossAllDocuments, required)
    - description (text, rows: 3)
    - coverImage (image with hotspot, alt field)
- Preview: select title, media from coverImage

**Schema index (studio/schemas/index.ts):**

- Import all three document types
- Export array: [tagType, authorType, seriesType]

**Update sanity.config.ts:**

- Import types from './schemas'
- Add to schema.types array </action> <verify> cd
  /Users/jloos/Developer/maxdaten-io/maxdaten.io/studio && npx tsc --noEmit TypeScript compilation
  should pass with no errors. </verify> <done> Tag, author, and series schemas created with proper
  fields. Studio config updated to include schemas. TypeScript compiles without errors. </done>
  </task>

</tasks>

<verification>
1. Run `cd studio && npm run dev` - Studio should start on localhost:3333
2. Navigate to Studio - should see Tag, Author, Series document types in sidebar
3. Create a test tag - should auto-generate slug from name
4. Create a second tag with same name - slug validation should fail with uniqueness error
5. Create an author - should have social links object with Twitter, GitHub, LinkedIn, Website fields
6. Create a series - should have title, slug, description, and cover image fields
</verification>

<success_criteria>

- Sanity Studio starts locally without errors
- Tag, Author, Series document types visible and creatable
- Slug fields auto-generate from source field
- Duplicate slugs rejected with validation error
- Author has structured social links (not freeform)
- All TypeScript compiles without errors </success_criteria>

<output>
After completion, create `.planning/phases/01-foundation/01-01-SUMMARY.md`
</output>
